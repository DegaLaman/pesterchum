from PyQt5 import QtGui as gui, QtCore as core, QtWidgets as widgets

class BugReporter(widgets.QDialog):
    def __init__(self, parent=None):
        widgets.QDialog.__init__(self, parent)
        self.mainwindow = parent
        self.setStyleSheet(self.mainwindow.theme["main/defaultwindow/style"])
        self.setWindowTitle("Report a Bug")
        self.setModal(False)

        self.title = widgets.QLabel("Bug Report:")

        layout_0 = widgets.QVBoxLayout()
        layout_0.addWidget(self.title)

        layout_0.addWidget(widgets.QLabel("Chumhandle:"))
        handleLabel = widgets.QLabel("The best chumhandle to contact you at for further information.")
        font = handleLabel.font()
        font.setPointSize(8)
        handleLabel.setFont(font)
        layout_0.addWidget(handleLabel)
        self.name = widgets.QLineEdit(self)
        self.name.setStyleSheet("background:white; font-weight:bold; color:black; font-size: 10pt;")
        layout_0.addWidget(self.name)

        layout_0.addWidget(widgets.QLabel("Description of bug:"))
        descLabel = widgets.QLabel("Include as much information as possible\n(theme, related options, what you were doing at the time, etc.)")
        font = descLabel.font()
        font.setPointSize(8)
        descLabel.setFont(font)
        layout_0.addWidget(descLabel)

        self.textarea = widgets.QTextEdit(self)
        self.textarea.setStyleSheet("background:white; font-weight:normal; color:black; font-size: 10pt;")

        layout_0.addWidget(self.textarea)
        self.ok = widgets.QPushButton("SEND")
        self.ok.clicked.connect(self.sendReport)
        self.cancel = widgets.QPushButton("CANCEL")
        self.cancel.clicked.connect(self.reject)
        self.ok.setDefault(True)
        layout_2 = widgets.QHBoxLayout()
        layout_2.addWidget(self.cancel)
        layout_2.addWidget(self.ok)

        layout_0.addLayout(layout_2)

        self.setLayout(layout_0)

    @core.pyqtSlot()
    def sendReport(self):
        name = str(self.mainwindow.profile().handle)
        bestname = str(self.name.text())
        os = ostools.osVer()
        full = ostools.platform.platform()
        python = ostools.platform.python_version()
        qt = core.qVersion()
        msg = str(self.textarea.toPlainText())

        if len(bestname) <= 0 or len(msg) <= 0:
            msgbox = gui.QMessageBox()
            msgbox.setStyleSheet(self.mainwindow.theme["main/defaultwindow/style"])
            msgbox.setText("You must fill out all fields first!")
            msgbox.setStandardButtons(gui.QMessageBox.Ok)
            ret = msgbox.exec_()
            return

        widgets.QDialog.accept(self)
        data = urllib.parse.urlencode({"name":name, "version": version._pcVersion, "bestname":bestname, "os":os, "platform":full, "python":python, "qt":qt, "msg":msg})
        print("Sending...")
        f = urllib.request.urlopen("http://distantsphere.com/pc/reporter.php", data)
        text = f.read()
        print(text)
        if text == "success!":
            print("Sent!")
        else:
            print("Problems ):")   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
